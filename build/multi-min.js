!function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){var i={getCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},setCookie:function(e,t,n){n=n||{};var i=n.expires;if("number"==typeof i&&i){var r=new Date;r.setTime(r.getTime()+1e3*i),i=n.expires=r}i&&i.toUTCString&&(n.expires=i.toUTCString()),t=encodeURIComponent(t);var o=e+"="+t;for(var a in n){o+="; "+a;var s=n[a];s!==!0&&(o+="="+s)}document.cookie=o},deleteCookie:function(e){this.setCookie(e,"",{expires:-1})},hashCode:function(e){return e.split("").reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0)},getUserID:function(){var e=this.getCookie("MpVideoVisitorID"),t=this;return e||(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}),t.setCookie("MpVideoVisitorID",e,{expires:864e3})),e},saveObject:function(e,t){var n=btoa(encodeURIComponent(JSON.stringify(e))),i=t||this.hashCode(n).toString(16);return this.setCookie(i,n,{expires:864e3}),i},getObject:function(e,t){var n=this.getCookie(e),i=null;if("undefined"!=typeof n&&n){var r=decodeURIComponent(atob(n));i=JSON.parse(r)}return"undefined"!=typeof t&&t&&this.deleteCookie(e),i}};t.exports=i},{}],2:[function(e,t,n){"use strict";function i(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}function r(e){var t={size:{width:"350",height:"400"},container:"#mp-video-widget-container-56015401b3da9-20",auth:{affiliate_id:"56015401b3da9",pid:"20"},errorFn:function(){},successFn:function(e){console.log(e)}},n=t;for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);var a=this;this.loaded=!1,this.configUrl="https://widget.market-place.su/videooptions/"+n.auth.affiliate_id+"_"+n.auth.pid+".json?p="+Math.random();var s=e.errorFn||function(){};e.successFn||function(){};o.ajax(this.configUrl,{errorFn:s,successFn:function(e){try{var t=JSON.parse(e);for(var r in t)t.hasOwnProperty(r)&&(a[r]=t[r]);var s=/Android|Silk|Mobile|PlayBook/.test(window.navigator.userAgent),u=i();switch(a.isDesktop=!s,!0){case u:a.ads=t["ads-mobile"].iOS;break;case s:a.ads=t["ads-mobile"].Android}o.ajax("https://widget.market-place.su/proxy_referer/",{errorFn:function(){},successFn:function(e){try{var i=JSON.parse(e);a.loaded=!0,a.referer=i,n.successFn(a),window.parent.postMessage(t,"*")}catch(e){console.log("битая конфигурация",e)}}})}catch(e){console.log("битая конфигурация",e)}}})}var o=e("./httpclient");t.exports=r},{"./httpclient":3}],3:[function(e,t,n){"use strict";var i={ajax:function(e,t){var n=e;t=t||{};var i=t.errorFn||function(){},r=t.successFn||function(){},o=t.type||"GET",a=t.data||{},s=JSON.stringify(a);if(o=o.toUpperCase(),window.XMLHttpRequest)var u=new XMLHttpRequest;else var u=new ActiveXObject("Microsoft.XMLHTTP");if("GET"==o){s=null,n.indexOf("?")<0&&(n+="?1=1");for(var c in a)a.hasOwnProperty(c)&&(n+="&"+c+"="+a[c])}u.open(o,n,!0),u.onreadystatechange=function(){4==u.readyState?200==u.status?r({response:u.responseText}):i({status:u.status}):i({status:u.readyState})},u.onreadystatechange=function(){4==u.readyState&&(200==u.status?r(u.responseText):i({status:u.status}))};try{u.withCredentials=t.withCredentials||!1,u.send(s)}catch(e){}}};t.exports=i},{}],4:[function(e,t,n){"use strict";function i(e){var e=e||o();return"undefined"==typeof window.MpFrameBridges&&(window.MpFrameBridges={}),"undefined"!=typeof window.MpFrameBridges[e]?window.MpFrameBridges[e]:(window.MpFrameBridges[e]=new a(e),window.MpFrameBridges[e])}function r(e,t,n){n.postMessage({name:e,data:t,bridgeAction:!0},"*")}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function a(e){this.index=e||o();var t={default:function(){}};this.execAction=function(e,n){var i=t[e]||t.default||function(){};i.call(this,n)},this.addAction=function(e,n){t[e]=n},this.showActions=function(){console.log(t)}}window.makeBridge=i,window.mp_bridge_listener=function(e){if("object"==typeof e.data&&"undefined"!=typeof e.data.bridgeAction&&1==e.data.bridgeAction){if("broadcast"==e.data.data.index&&"undefined"!=typeof window.MpFrameBridges)for(var t in window.MpFrameBridges)window.MpFrameBridges.hasOwnProperty(t)&&window.MpFrameBridges[t].execAction(e.data.name,e.data.data);i(e.data.data.index).execAction(e.data.name,e.data.data)}},"undefined"==typeof window.MpBridgeListenerAttached&&(window.addEventListener?window.addEventListener("message",mp_bridge_listener):window.attachEvent("onmessage",mp_bridge_listener),window.MpBridgeListenerAttached=!0),t.exports={Bridge:i,callAction:r}},{}],5:[function(e,t,n){"use strict";function i(e,t){switch(e){case"timeoutEl":var n=parseInt(t.dur)-parseInt(t.sec);n=n>0?n:0;var i="<span class='innerSpan'>Реклама: "+n;return t.showControls&&t.skipTime>0&&(i+="  Пропустить через: "+(t.skipTime>0?t.skipTime:0)),i+=" </span>";case"advLink":return"<span class='innerSpan' >"+t+"</span>";case"skipAd":return"<span class='innerSpan'>Пропустить </span>";case"closeAd":return"<span class='innerSpan'> </span>";case"muteButton":return"<span class='innerSpan "+(t?"un":"")+"mute'> </span>";default:return""}}function r(){this.defaultEnded=!1,this.config={},this.links=[],this.tmpReadArCnt=0,this.currentIndexListen=0,this.ListenedIndexes={},this.tmpReadArCnt=0,this.emptyStart=0,this.thirdPartyFlag=0,this.reporter=null,this.defaultURLs=["http://apptoday.ru/videotest/autoplay/trailers/ivancarevichiseryjvolk3_trailer2_854.mp4","http://apptoday.ru/videotest/autoplay/trailers/minions_rutrailer_1280.mp4"],"undefined"==typeof this.GlobalMyGUITemp&&(this.GlobalMyGUITemp="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}),window.GlobalMyGUITemp=this.GlobalMyGUITemp),this.fromUrl=window.location!=window.parent.location?document.referrer:document.location.href,this.cookieUserid=a.getUserID(),this.cacheloadedIndexes={},this.cacheStatisticIndexes={},this.referer="http://apptoday.ru";this.container=document.getElementById("container"),this.placeHolder=document.getElementById("placeholder"),this.pid="",this.affiliate_id="",this.queueToPlay=[],this.queueToPlaySemaphore=0,this.resourcesToPlay={},this.plSettings={},this.slot=null}var o=(e("./httpclient"),e("vast-player")),a=e("./CookieDriver"),s=e("./iFrameBridge");window.Bridge=s.Bridge,window.CallAction=s.callAction,window.MPOverControl={CurrentLoadedXmlIndex:-1,reportCurrentLoader:function(e){}},r.prototype.setConfig=function(e,t){this.collbackFunction=t,e.hasOwnProperty("adslimit")||(e.adslimit=3),this.config=e,this.pid=e.pid,this.affiliate_id=e.affiliate_id,this.links=e.ads,"undefined"!=typeof e.referer&&(this.referer=e.referer),this.tmpReadArCnt=this.links.length,this.container.style.width=e.width+"px",this.container.style.height=e.height+"px",this.placeHolder&&(this.placeHolder.style.width=e.width+"px",this.placeHolder.style.height=e.height+"px"),this.pushQueue(0)},r.prototype.checkLoadedQueue=function(){var e,t=0;for(e in this.cacheloadedIndexes){if(console.log([3187744,e,this.cacheloadedIndexes[e],t,this.tmpReadArCnt,this.links[e].title]),0==this.cacheloadedIndexes[e])return!1;t++}return console.log([3187744,this.tmpReadArCnt,t,this.emptyStart]),!(this.tmpReadArCnt>t)},r.prototype.pushQueue=function(e){if(console.log([318122,"а",this.config.adslimit]),this.config.adslimit<=0)return console.log([23455,this.queueToPlaySemaphore,"волк тоже"]),this.currentIndexListen=1,void(this.queueToPlaySemaphore||this.readyToPlayThird());var t=this;if("undefined"==typeof this.links[e])return this.currentIndexListen=1,void(this.emptyStart&&this.queueToPlaySemaphore||this.readyToPlayThird());this.cacheloadedIndexes[e]=0;var n=this.links[e].src.replace(/\{([a-z]+)\}/g,function(e){var n=e.replace(/[\{\}]+/g,"");switch(n){case"rnd":return Math.random();case"ref":return encodeURIComponent(t.referer)}return e}),i=new o(document.getElementById("container"),{timerFunc:function(){}});i.linkIndex=e,t.sendStatistic({id:t.links[e].id,eventName:"srcRequest"}),i.loadNew(n).then(function(n){console.log([4001,"плеер загрузился",n,t.links[e].title]),t.cacheloadedIndexes[e]=1,t.startPlayQueue(i)}).catch(function(n){console.log([4001,"плеер не загрузился",n,t.links[e].title]),t.cacheloadedIndexes[e]=3,t.pushQueue(e+1)})},r.prototype.sendPixel=function(e){var t={key:this.GlobalMyGUITemp,fromUrl:encodeURIComponent(this.fromUrl),pid:this.pid,affiliate_id:this.affiliate_id,id_src:e.id},n="https://api.market-place.su/Product/video/l1quest.php?p="+Math.random()+"&data="+encodeURIComponent(JSON.stringify(t)),i=new Image(1,1);i.src=n},r.prototype.startPlayQueue=function(e){this.emptyStart=1;var t=this;if(this.queueToPlaySemaphore)return void setTimeout(function(){t.startPlayQueue(e)},300);if(console.log([318122,"а",t.config.adslimit]),this.config.adslimit<=0)return void this.readyToPlayThird();this.queueToPlaySemaphore=1;var n={},r={};this.clearExtraSlot();var o=a.getUserID(),s=a.getObject(o);s||(s={mute:!1,tvo:.2,vo:.7}),this.plSettings=s,e.__private__.config.timerFunc=function(i){i.sec>0&&"function"==typeof e.ControllerAction&&e.ControllerAction(i),i.sec>0&&"undefined"==typeof n[i.index]&&(n[i.index]=1),i.sec>3&&"undefined"==typeof r[i.index]&&"undefined"!=typeof t.links[i.index]&&(r[i.index]=1,e.hasOwnProperty("_ownTimer")?console.log([95558,"мог бы!",t.links[i.index].title]):(console.log([95558,"Плеер взыграл на три!",t.links[i.index].title]),e._ownTimer=1,t.config.adslimit--,t.sendStatistic({id:t.links[i.index].id,eventName:"filterPlayMedia"}),t.sendPixel({id:t.links[i.index].id}),t.pushQueue(e.__private__.index+1)))},e.on("AdVolumeChange",function(){"undefined"!=typeof this.muteButton&&(this.muteButton.innerHTML=i("muteButton",this.adVolume))}),e.once("AdStopped",function(){return t.queueToPlaySemaphore=0,console.log([95558,"Плеер закончился!",t.currentIndexListen,t.links[e.__private__.index].title]),t.currentIndexListen?void t.readyToPlayThird():(console.log([955887,t.links.length]),t.checkLoadedQueue()?void t.readyToPlayThird():void 0)}),e.once("AdError",function(n){var i="";"undefined"!=typeof n&&"undefined"!=typeof n.message?i=n.message:"undefined"!=typeof n&&(i=JSON.stringify(n)),t.sendStatistic({id:t.links[e.__private__.index].id,eventName:"errorPlayMedia",mess:i}),console.log([95558,"Ошибка плеера лог!",t.links[e.__private__.index].title,i])}),e._reporter.PlayToBridge=function(n,i){switch(t.sendStatistic({id:t.links[e.__private__.index].id,eventName:n,mess:""}),n){case"firstQuartile":e.hasOwnProperty("_ownTimer")||(console.log([95558,"Плеер взыграл по три!",t.links[e.__private__.index].title]),e._ownTimer=1,t.config.adslimit--,t.sendStatistic({id:t.links[e.__private__.index].id,eventName:"filterPlayMedia"}),t.sendPixel({id:t.links[e.__private__.index].id}),t.pushQueue(e.__private__.index+1))}CallAction("adEvent",{index:t.config.index,eventName:n},window.parent)},e.preparePlay(!0).then(function(){console.log([95558,"Плеер готов!",e.__private__.pType,t.links[e.__private__.index].title]),e.startAd().then(function(){s.mute?e.adVolume=0:e.adVolume=.6,t.container.style.opacity="1",t.container.style.filter="alpha(opacity=50)",t.placeHolder&&(t.placeHolder.style.display="none"),3==e.__private__.pType&&e.__private__.index>=0&&t.createExtraSlot(e),t.container.style.display="block";var n=document.getElementById("container2");n&&(n.style.display="none")}).catch(function(n){console.log([95558,"Плеер не заиграл!",t.links[e.__private__.index].title,reason])})}).catch(function(n){console.log([95558,"Плеер не готов!",t.links[e.__private__.index].title,n]),t.queueToPlaySemaphore=0,t.pushQueue(e.__private__.index+1)}),console.log([4005,e])},r.prototype.checkMuteButton=function(){},r.prototype.createExtraSlot=function(e){var t=this;e.isPaused=0,e.isClicked=0,this.slot=document.createElement("DIV"),this.slot.setAttribute("id","videoslot"),this.slot.style.width=this.config.width+"px",this.slot.style.height=this.config.height+"px",this.slot.style.border="1px solid #000000",this.slot.style.position="absolute",this.slot.style.top="0",this.slot.style.left="0",this.slot.style.zIndex=999,this.container.style.position="relative",this.container.appendChild(this.slot);var n=[],r=[],o=[],s=[],u=[],c=[],l=[];e.ControllerAction=function(t){t.index==-1,o.length||o.push("00:10"),s.length||s.push("00:05");var n=(60*parseInt(o[0].split(":")[0])+parseInt(o[0].split(":")[1]))%parseInt(t.dur),a=(60*parseInt(s[0].split(":")[0])+parseInt(s[0].split(":")[1]))%parseInt(t.dur);n>a&&(n=a);var u=a<=parseInt(t.sec)&&a>0,c=n<=parseInt(t.sec)&&n>0;t.skipTime=n-parseInt(t.sec),t.showControls="1"==r[0];var l=i("timeoutEl",t);"undefined"!=typeof e.timeoutDiv&&(e.timeoutDiv.innerHTML=l),"1"==r[0]&&u&&(e.closeDiv.style.display="block"),"1"==r[0]&&c&&(e.skipDiv.style.display="block")},e.drawControls=function(){t.clickable=document.createElement("DIV"),t.clickable.setAttribute("id","clickable"),t.clickable.style.width=t.config.width+"px",t.clickable.style.height=t.config.height+"px",t.clickable.style.border="1px solid #000000",t.clickable.style.position="absolute",t.clickable.style.top="0",t.clickable.style.left="0",t.clickable.style.zIndex=1e3,t.resumeButton=document.createElement("DIV"),t.resumeButton.style.zIndex=1003,t.resumeButton.style.color="#FFFFFF",t.resumeButton.style.width="100%",t.resumeButton.style.height="100%",t.resumeButton.style.cursor="pointer",t.resumeButton.style.display="none",t.resumeButton.className="resume-play",t.clickable.appendChild(t.resumeButton),t.slot.appendChild(t.clickable);var n=document.createElement("div");n.id="timeoutDiv",e.timeoutDiv=n,t.slot.appendChild(n);var r=document.createElement("div");r.id="closeDiv",e.closeDiv=r,t.slot.appendChild(r),r.innerHTML=i("closeAd"),r.style.display="none",r.onclick=function(t){t.preventDefault(),e._reporter.manualCase("close"),e.stopAd()};var o=document.createElement("div");e.skipDiv=o,o.id="skipDiv",t.slot.appendChild(o),o.innerHTML=i("skipAd"),o.style.display="none",o.onclick=function(t){t.preventDefault(),e._reporter.manualCase("skip");for(var n=0;n<c.length;n++)(new Image).src=c[n];e.stopAd()};var s=document.createElement("div");s.id="advLink",e.advLink=s,t.slot.appendChild(s),s.innerHTML=i("advLink",decodeURIComponent(u[0]));var d=e.__private__.vast.get("ads[0].creatives[0].videoClicks.clickThrough");d||(s.style.display="none"),s.onclick=function(e){e.preventDefault();for(var n=0;n<l.length;n++)(new Image).src=l[n];t.ConrolePaused(1)};var p=document.createElement("div");p.id="muteButton",p.style.border="1px solid red",p.style.zIndex=9999,p.style.position="absolute",e.muteButton=p,t.slot.appendChild(p),p.innerHTML=i("muteButton",e.adVolume),p.onclick=function(n){n.preventDefault(),e.adVolume=e.adVolume?0:.6;var i=a.getUserID();return e.adVolume?t.plSettings.mute=!1:t.plSettings.mute=!0,a.saveObject(t.plSettings,i),!1}},e.__private__.vast.map("ads[0].extensions",function(e){"linkTxt"==e.type&&e.value&&u.push(e.value.replace(/^\s+|\s+$/,"")),"isClickable"==e.type&&e.value&&n.push(e.value.replace(/^\s+|\s+$/,"")),"controls"==e.type&&e.value&&r.push(e.value.replace(/^\s+|\s+$/,"")),"skipTime"==e.type&&e.value&&o.push(e.value.replace(/^\s+|\s+$/,"")),"skipTime2"==e.type&&e.value&&s.push(e.value.replace(/^\s+|\s+$/,"")),"skipAd"==e.type&&e.value&&c.push(e.value.replace(/^\s+|\s+$/,"")),"addClick"==e.type&&e.value&&l.push(e.value.replace(/^\s+|\s+$/,""))}),u.length||u.push("Перейти на сайт рекламодателя"),n.length||n.push(0),e.drawControls(),t.clickable.onclick=function(){t.ConrolePaused(n[0],e)}},r.prototype.ConrolePaused=function(e,t){if(t)if(t.isPaused)"undefined"!=typeof this.resumeButton&&(this.resumeButton.style.display="none"),t.isPaused=0,t.resumeAd();else{this.resumeButton,this.resumeButton.style.display="block",t.isPaused=1,t.pauseAd(),t._reporter.manualCase("clickThrough");var n=t.__private__.vast.get("ads[0].creatives[0].videoClicks.clickThrough"),i=e;i&&n&&window.open(n)}},r.prototype.clearExtraSlot=function(){"undefined"!=typeof this.resumeButton&&delete this.resumeButton,this.slot&&this.container.removeChild(this.slot),this.slot=null},r.prototype.readyToPlayThird=function(){this.thirdPartyFlag||(this.thirdPartyFlag=1,this.clearExtraSlot(),this.container.innerHTML="",this.container.style.display="none","function"==typeof this.collbackFunction&&(console.log("переход 2"),this.collbackFunction(this.config)))},r.prototype.sendStatistic=function(e){var t="";if("undefined"!=typeof e.eventName&&("undefined"==typeof this.cacheStatisticIndexes[e.id]&&(this.cacheStatisticIndexes[e.id]={}),"undefined"!=typeof e.mess&&(t=e.mess),"undefined"==typeof this.cacheStatisticIndexes[e.id][e.eventName])){this.cacheStatisticIndexes[e.id][e.eventName]=1;var n={key:this.GlobalMyGUITemp,fromUrl:encodeURIComponent(this.fromUrl),pid:this.pid,affiliate_id:this.affiliate_id,cookie_id:this.cookieUserid,id_src:e.id,event:e.eventName,mess:t},i="https://api.market-place.su/Product/video/l1stat.php?p="+Math.random()+"&data="+encodeURIComponent(JSON.stringify(n)),r=new Image(1,1);r.src=i}},r.prototype.overTvigle=function(){if(this.container.innerHTML="",this.container.style.display="block",this.container.style.opacity="1",this.container.style.filter="alpha(opacity=50)",this.placeHolder&&(this.placeHolder.style.display="block"),!this.config.isDesktop)return this.defaultEnded=1,void this.checkDefaultTrailer(10);var e=document.createElement("iframe");e.width=this.config.width,e.height=this.config.height,e.frameBorder=0,e.margin=0;var t="/frame_default.html?width="+this.config.width+"&height="+this.config.height+"&affiliate_id="+this.affiliate_id+"&pid="+this.pid+"&key="+this.GlobalMyGUITemp+"&fromUrl="+this.fromUrl+"&rnd="+Math.random();e.src=t,this.container.appendChild(e),this.checkDefaultTrailer(35)},r.prototype.checkDefaultTrailer=function(e){if(!(e<=0)){if("undefined"==typeof this.defaultEnded||!this.defaultEnded){e--;var t=this;return void setTimeout(function(){t.checkDefaultTrailer(e)},500)}var n=0,i=1,r=Math.floor(Math.random()*(i-n+1))+n;this.createTrailer(this.defaultURLs[r])}},r.prototype.moveShirma=function(){this.placeHolder&&(this.placeHolder.style.display="none")},r.prototype.createTrailer=function(e){this.container.innerHTML="";var t=[{apiFramework:null,bitrate:692,delivery:"progressive",height:360,id:"1",maintainAspectRatio:null,scalable:null,type:"video/mp4",uri:e,width:640}],n=this,i=new o(document.getElementById("container"),{timerFunc:function(){}});i.__private__.index=-1,i.PlayMp4({mediafiles:t}).then(function(e){e.__private__.player.video.onended=function(){n.container.innerHTML="",n.container.style.display="none"},e.startAd().then(function(){e.adVolume=0,n.container.style.opacity="1",n.container.style.filter="alpha(opacity=50)",n.placeHolder&&(n.placeHolder.style.display="none"),n.container.style.display="block";var t=document.getElementById("container2");t&&(t.style.display="none")}).catch(function(e){})}).catch(function(e){console.log([454,"плеер сорвался",e]),n.container.innerHTML="",n.container.style.display="block"})},t.exports=r},{"./CookieDriver":1,"./httpclient":3,"./iFrameBridge":4,"vast-player":24}],6:[function(e,t,n){function i(e){if(e)return r(e)}function r(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}"undefined"!=typeof t&&(t.exports=i),i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i,r=0;r<n.length;r++)if(i=n[r],i===t||i.fn===t){n.splice(r,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var i=0,r=n.length;i<r;++i)n[i].apply(this,t)}return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],7:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=20,i.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if("undefined"==typeof this._events[e])return!1;if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,o=new Array(i-1),u=1;u<i;u++)o[u-1]=arguments[u];n.apply(this,o)}else if(a(n)){for(i=arguments.length,o=new Array(i-1),u=1;u<i;u++)o[u-1]=arguments[u];for(c=n.slice(),i=c.length,u=0;u<i;u++)c[u].apply(this,o)}return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned){var n;n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}],8:[function(e,t,n){(function(e){"use strict";function n(){l=!0;for(var e,t,n=d.length;n;){for(t=d,d=[],e=-1;++e<n;)t[e]();n=d.length}l=!1}function i(e){1!==d.push(e)||l||r()}var r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var a=0,s=new o(n),u=e.document.createTextNode("");s.observe(u,{characterData:!0}),r=function(){u.data=a=++a%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var c=new e.MessageChannel;c.port1.onmessage=n,r=function(){c.port2.postMessage(0)}}var l,d=[];t.exports=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){"use strict";function i(){}function r(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,e!==i&&u(this,e)}function o(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function a(e,t,n){h(function(){var i;try{i=t(n)}catch(t){return v.reject(e,t)}i===e?v.reject(e,new TypeError("Cannot resolve promise with itself")):v.resolve(e,i)})}function s(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function n(t){o&&a||(o=!0,a=!0,v.reject(e,t))}function i(t){o||(o=!0,v.resolve(e,t))}function r(){t(i,n)}var o=!1,a=!1,s=c(r);"error"===s.status&&n(s.value)}function c(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function l(e){return e instanceof this?e:v.resolve(new this(i),e)}function d(e){var t=new this(i);return v.reject(t,e)}function p(e){function t(e,t){function i(e){a[t]=e,++s!==r||o||(o=!0,v.resolve(c,a))}n.resolve(e).then(i,function(e){o||(o=!0,v.reject(c,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,u=-1,c=new this(i);++u<r;)t(e[u],u);return c}function f(e){function t(e){n.resolve(e).then(function(e){o||(o=!0,v.resolve(s,e))},function(e){o||(o=!0,v.reject(s,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=-1,s=new this(i);++a<r;)t(e[a]);return s}var h=e("immediate"),v={},m=["REJECTED"],y=["FULFILLED"],g=["PENDING"];t.exports=r,r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===y||"function"!=typeof t&&this.state===m)return this;var n=new this.constructor(i);if(this.state!==g){var r=this.state===y?e:t;a(n,r,this.outcome)}else this.queue.push(new o(n,e,t));return n},o.prototype.callFulfilled=function(e){v.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){v.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},v.resolve=function(e,t){var n=c(s,t);if("error"===n.status)return v.reject(e,n.value);var i=n.value;if(i)u(e,i);else{e.state=y,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},v.reject=function(e,t){e.state=m,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},r.resolve=l,r.reject=d,r.all=p,r.race=f},{immediate:8}],10:[function(e,t,n){!function(e,n){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=n():"function"==typeof define&&define.amd?define([],n):e.objectPath=n()}(this,function(){"use strict";function e(e){if(!e)return!0;if(o(e)&&0===e.length)return!0;for(var t in e)if(d.call(e,t))return!1;return!0}function t(e){return l.call(e)}function n(e){return"number"==typeof e||"[object Number]"===t(e)}function i(e){return"string"==typeof e||"[object String]"===t(e)}function r(e){return"object"==typeof e&&"[object Object]"===t(e)}function o(e){return"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===t(e)}function a(e){return"boolean"==typeof e||"[object Boolean]"===t(e)}function s(e){var t=parseInt(e);return t.toString()===e?t:e}function u(t,r,o,a){if(n(r)&&(r=[r]),e(r))return t;if(i(r))return u(t,r.split("."),o,a);var c=s(r[0]);if(1===r.length){var l=t[c];return void 0!==l&&a||(t[c]=o),l}return void 0===t[c]&&(n(c)?t[c]=[]:t[c]={}),u(t[c],r.slice(1),o,a)}function c(t,r){if(n(r)&&(r=[r]),!e(t)){if(e(r))return t;if(i(r))return c(t,r.split("."));var a=s(r[0]),u=t[a];if(1===r.length)void 0!==u&&(o(t)?t.splice(a,1):delete t[a]);else if(void 0!==t[a])return c(t[a],r.slice(1));return t}}var l=Object.prototype.toString,d=Object.prototype.hasOwnProperty,p={};return p.ensureExists=function(e,t,n){return u(e,t,n,!0)},p.set=function(e,t,n,i){return u(e,t,n,i)},p.insert=function(e,t,n,i){var r=p.get(e,t);i=~~i,o(r)||(r=[],p.set(e,t,r)),r.splice(i,0,n)},p.empty=function(t,s){if(e(s))return t;if(!e(t)){var u,c;if(!(u=p.get(t,s)))return t;if(i(u))return p.set(t,s,"");if(a(u))return p.set(t,s,!1);if(n(u))return p.set(t,s,0);if(o(u))u.length=0;else{if(!r(u))return p.set(t,s,null);for(c in u)d.call(u,c)&&delete u[c]}}},p.push=function(e,t){var n=p.get(e,t);o(n)||(n=[],p.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},p.coalesce=function(e,t,n){for(var i,r=0,o=t.length;r<o;r++)if(void 0!==(i=p.get(e,t[r])))return i;return n},p.get=function(t,r,o){if(n(r)&&(r=[r]),e(r))return t;if(e(t))return o;if(i(r))return p.get(t,r.split("."),o);var a=s(r[0]);return 1===r.length?void 0===t[a]?o:t[a]:p.get(t[a],r.slice(1),o)},p.del=function(e,t){return c(e,t)},p})},{}],11:[function(e,t,n){function i(){}var r=t.exports={};r.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=i,r.addListener=i,r.once=i,r.off=i,r.removeListener=i,r.removeAllListeners=i,r.emit=i,r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],12:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var d,p,f,h,v=e[l].replace(s,"%20"),m=v.indexOf(n);m>=0?(d=v.substr(0,m),p=v.substr(m+1)):(d=v,p=""),f=decodeURIComponent(d),h=decodeURIComponent(p),i(a,f)?r(a[f])?a[f].push(h):a[f]=[a[f],h]:a[f]=h}return a};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e);
}},{}],13:[function(e,t,n){"use strict";function i(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?i(a(e),function(i){var a=encodeURIComponent(r(i))+n;return o(e[i])?e[i].map(function(e){return a+encodeURIComponent(r(e))}).join(t):a+encodeURIComponent(r(e[i]))}).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],14:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":12,"./encode":13}],15:[function(e,t,n){t.exports=function(e,t,n){for(var i=0,r=e.length,o=3==arguments.length?n:e[i++];i<r;)o=t.call(null,o,e[i],++i,e);return o}},{}],16:[function(e,t,n){var i,r,o,a=e("object-path");o=function(e){return function(t){return typeof t===e}},r=function(e,t){var n=1,i=t||function(e,t){return t};return"-"===e[0]&&(n=-1,e=e.substr(1)),function(t,r){var o,s=i(e,a.get(t,e)),u=i(e,a.get(r,e));return s<u&&(o=-1),s>u&&(o=1),s===u&&(o=0),o*n}},i=function(){var e=Array.prototype.slice.call(arguments),t=e.filter(o("string")),n=e.filter(o("function"))[0];return function(e,i){for(var o=t.length,a=0,s=0;0===a&&s<o;)a=r(t[s],n)(e,i),s++;return a}},t.exports=i},{"object-path":10}],17:[function(e,t,n){function i(){}function r(e){var t={}.toString.call(e);switch(t){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function o(e){if(!_(e))return e;var t=[];for(var n in e)null!=e[n]&&a(t,n,e[n]);return t.join("&")}function a(e,t,n){return Array.isArray(n)?n.forEach(function(n){a(e,t,n)}):void e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}function s(e){for(var t,n,i={},r=e.split("&"),o=0,a=r.length;o<a;++o)n=r[o],t=n.split("="),i[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return i}function u(e){var t,n,i,r,o=e.split(/\r?\n/),a={};o.pop();for(var s=0,u=o.length;s<u;++s)n=o[s],t=n.indexOf(":"),i=n.slice(0,t).toLowerCase(),r=x(n.slice(t+1)),a[i]=r;return a}function c(e){return/[\/+]json\b/.test(e)}function l(e){return e.split(/ *; */).shift()}function d(e){return y(e.split(/ *; */),function(e,t){var n=t.split(/ *= */),i=n.shift(),r=n.shift();return i&&r&&(e[i]=r),e},{})}function p(e,t){t=t||{},this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=u(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function f(e,t){var n=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new p(n)}catch(t){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=t,e.rawResponse=n.xhr&&n.xhr.responseText?n.xhr.responseText:null,e.statusCode=n.xhr&&n.xhr.status?n.xhr.status:null,n.callback(e)}if(n.emit("response",t),e)return n.callback(e,t);if(t.status>=200&&t.status<300)return n.callback(e,t);var i=new Error(t.statusText||"Unsuccessful HTTP response");i.original=e,i.response=t,i.status=t.status,n.callback(i,t)})}function h(e,t){var n=w("DELETE",e);return t&&n.end(t),n}var v,m=e("emitter"),y=e("reduce"),g=e("./request-base"),_=e("./is-object");v="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var w=t.exports=e("./request").bind(null,f);w.getXHR=function(){if(!(!v.XMLHttpRequest||v.location&&"file:"==v.location.protocol&&v.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1};var x="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};w.serializeObject=o,w.parseString=s,w.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},w.serialize={"application/x-www-form-urlencoded":o,"application/json":JSON.stringify},w.parse={"application/x-www-form-urlencoded":s,"application/json":JSON.parse},p.prototype.get=function(e){return this.header[e.toLowerCase()]},p.prototype.setHeaderProperties=function(e){var t=this.header["content-type"]||"";this.type=l(t);var n=d(t);for(var i in n)this[i]=n[i]},p.prototype.parseBody=function(e){var t=w.parse[this.type];return!t&&c(this.type)&&(t=w.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null},p.prototype.setStatusProperties=function(e){1223===e&&(e=204);var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.notFound=404==e,this.forbidden=403==e},p.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,i="cannot "+t+" "+n+" ("+this.status+")",r=new Error(i);return r.status=this.status,r.method=t,r.url=n,r},w.Response=p,m(f.prototype);for(var b in g)f.prototype[b]=g[b];f.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr&&this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},f.prototype.type=function(e){return this.set("Content-Type",w.types[e]||e),this},f.prototype.responseType=function(e){return this._responseType=e,this},f.prototype.accept=function(e){return this.set("Accept",w.types[e]||e),this},f.prototype.auth=function(e,t,n){switch(n||(n={type:"basic"}),n.type){case"basic":var i=btoa(e+":"+t);this.set("Authorization","Basic "+i);break;case"auto":this.username=e,this.password=t}return this},f.prototype.query=function(e){return"string"!=typeof e&&(e=o(e)),e&&this._query.push(e),this},f.prototype.attach=function(e,t,n){return this._getFormData().append(e,t,n||t.name),this},f.prototype._getFormData=function(){return this._formData||(this._formData=new v.FormData),this._formData},f.prototype.send=function(e){var t=_(e),n=this._header["content-type"];if(t&&_(this._data))for(var i in e)this._data[i]=e[i];else"string"==typeof e?(n||this.type("form"),n=this._header["content-type"],"application/x-www-form-urlencoded"==n?this._data=this._data?this._data+"&"+e:e:this._data=(this._data||"")+e):this._data=e;return!t||r(e)?this:(n||this.type("json"),this)},p.prototype.parse=function(e){return v.console&&console.warn("Client-side parse() method has been renamed to serialize(). This method is not compatible with superagent v2.0"),this.serialize(e),this},p.prototype.serialize=function(e){return this._parser=e,this},f.prototype.callback=function(e,t){var n=this._callback;this.clearTimeout(),n(e,t)},f.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},f.prototype.timeoutError=function(){var e=this._timeout,t=new Error("timeout of "+e+"ms exceeded");t.timeout=e,this.callback(t)},f.prototype.withCredentials=function(){return this._withCredentials=!0,this},f.prototype.end=function(e){var t=this,n=this.xhr=w.getXHR(),o=this._query.join("&");this._timeout=6e3;var a=this._timeout,s=this._formData||this._data;this._callback=e||i,n.onreadystatechange=function(){if(4==n.readyState){var e;try{e=n.status}catch(t){e=0}if(0==e){if(t.timedout)return t.timeoutError();if(t.aborted)return;return t.crossDomainError()}t.emit("end")}};var u=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),e.direction="download",t.emit("progress",e)};this.hasListeners("progress")&&(n.onprogress=u);try{n.upload&&this.hasListeners("progress")&&(n.upload.onprogress=u)}catch(e){}if(a&&!this._timer&&(this._timer=setTimeout(function(){t.timedout=!0,t.abort()},a)),o&&(o=w.serializeObject(o),this.url+=~this.url.indexOf("?")?"&"+o:"?"+o),this.username&&this.password?n.open(this.method,this.url,!0,this.username,this.password):n.open(this.method,this.url,!0),this._withCredentials&&(n.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof s&&!r(s)){var l=this._header["content-type"],d=this._parser||w.serialize[l?l.split(";")[0]:""];!d&&c(l)&&(d=w.serialize["application/json"]),d&&(s=d(s))}for(var p in this.header)null!=this.header[p]&&n.setRequestHeader(p,this.header[p]);return this._responseType&&(n.responseType=this._responseType),this.emit("request",this),n.send("undefined"!=typeof s?s:null),this},w.Request=f,w.get=function(e,t,n){var i=w("GET",e);return"function"==typeof t&&(n=t,t=null),t&&i.query(t),n&&i.end(n),i},w.head=function(e,t,n){var i=w("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},w.del=h,w.delete=h,w.patch=function(e,t,n){var i=w("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},w.post=function(e,t,n){var i=w("POST",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i},w.put=function(e,t,n){var i=w("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&i.send(t),n&&i.end(n),i}},{"./is-object":18,"./request":20,"./request-base":19,emitter:6,reduce:15}],18:[function(e,t,n){function i(e){return null!=e&&"object"==typeof e}t.exports=i},{}],19:[function(e,t,n){var i=e("./is-object");n.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},n.parse=function(e){return this._parser=e,this},n.timeout=function(e){return this._timeout=e,this},n.then=function(e,t){return this.end(function(n,i){n?t(n):e(i)})},n.use=function(e){return e(this),this},n.get=function(e){return this._header[e.toLowerCase()]},n.getHeader=n.get,n.set=function(e,t){if(i(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},n.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},n.field=function(e,t){return this._getFormData().append(e,t),this}},{"./is-object":18}],20:[function(e,t,n){function i(e,t,n){return"function"==typeof n?new e("GET",t).withCredentials().end(n):2==arguments.length?new e("GET",t).withCredentials():new e(t,n).withCredentials()}t.exports=i},{}],21:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],22:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],23:[function(e,t,n){(function(t,i){function r(e,t){var i={seen:[],stylize:a};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),v(t)?i.showHidden=t:t&&n._extend(i,t),x(i.showHidden)&&(i.showHidden=!1),x(i.depth)&&(i.depth=2),x(i.colors)&&(i.colors=!1),x(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),u(i,e,i.depth)}function o(e,t){var n=r.styles[t];return n?"["+r.colors[n][0]+"m"+e+"["+r.colors[n][1]+"m":e}function a(e,t){return e}function s(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function u(e,t,i){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);return _(r)||(r=u(e,r,i)),r}var o=c(e,t);if(o)return o;var a=Object.keys(t),v=s(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),T(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(E(t)){var m=t.name?": "+t.name:"";return e.stylize("[Function"+m+"]","special")}if(b(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(k(t))return e.stylize(Date.prototype.toString.call(t),"date");if(T(t))return l(t)}var y="",g=!1,w=["{","}"];if(h(t)&&(g=!0,w=["[","]"]),E(t)){var x=t.name?": "+t.name:"";y=" [Function"+x+"]"}if(b(t)&&(y=" "+RegExp.prototype.toString.call(t)),k(t)&&(y=" "+Date.prototype.toUTCString.call(t)),T(t)&&(y=" "+l(t)),0===a.length&&(!g||0==t.length))return w[0]+y+w[1];if(i<0)return b(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var A;return A=g?d(e,t,i,v,a):a.map(function(n){return p(e,t,i,v,n,g)}),e.seen.pop(),f(A,y,w)}function c(e,t){if(x(t))return e.stylize("undefined","undefined");if(_(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,i,r){for(var o=[],a=0,s=t.length;a<s;++a)L(t,String(a))?o.push(p(e,t,n,i,String(a),!0)):o.push("");return r.forEach(function(r){r.match(/^\d+$/)||o.push(p(e,t,n,i,r,!0))}),o}function p(e,t,n,i,r,o){var a,s,c;if(c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]},c.get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special")),L(i,r)||(a="["+r+"]"),s||(e.seen.indexOf(c.value)<0?(s=m(n)?u(e,c.value,null):u(e,c.value,n-1),s.indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),x(a)){if(o&&r.match(/^\d+$/))return s;a=JSON.stringify(""+r),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function f(e,t,n){var i=0,r=e.reduce(function(e,t){return i++,t.indexOf("\n")>=0&&i++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function h(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function m(e){return null===e}function y(e){return null==e}function g(e){return"number"==typeof e}function _(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function x(e){return void 0===e}function b(e){return A(e)&&"[object RegExp]"===S(e)}function A(e){return"object"==typeof e&&null!==e}function k(e){return A(e)&&"[object Date]"===S(e)}function T(e){return A(e)&&("[object Error]"===S(e)||e instanceof Error)}function E(e){return"function"==typeof e}function C(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function S(e){return Object.prototype.toString.call(e)}function P(e){return e<10?"0"+e.toString(10):e.toString(10)}function I(){var e=new Date,t=[P(e.getHours()),P(e.getMinutes()),P(e.getSeconds())].join(":");return[e.getDate(),M[e.getMonth()],t].join(" ")}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var j=/%[sdj%]/g;n.format=function(e){if(!_(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(r(arguments[n]));return t.join(" ")}for(var n=1,i=arguments,o=i.length,a=String(e).replace(j,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),s=i[n];n<o;s=i[++n])a+=m(s)||!A(s)?" "+s:" "+r(s);return a},n.deprecate=function(e,r){function o(){if(!a){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),a=!0}return e.apply(this,arguments)}if(x(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(t.noDeprecation===!0)return e;var a=!1;return o};var D,V={};n.debuglog=function(e){if(x(D)&&(D=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!V[e])if(new RegExp("\\b"+e+"\\b","i").test(D)){var i=t.pid;V[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else V[e]=function(){};return V[e]},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=h,n.isBoolean=v,n.isNull=m,n.isNullOrUndefined=y,n.isNumber=g,n.isString=_,n.isSymbol=w,n.isUndefined=x,n.isRegExp=b,n.isObject=A,n.isDate=k,n.isError=T,n.isFunction=E,n.isPrimitive=C,n.isBuffer=e("./support/isBuffer");var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",I(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!A(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e}}).call(this,e("pBGvAp"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":22,inherits:21,pBGvAp:11}],24:[function(e,t,n){t.exports=e("./lib/VASTPlayer")},{"./lib/VASTPlayer":28}],25:[function(e,t,n){"use strict";function i(e,t,n){t.on(e,function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];n.emit.apply(n,[e].concat(t))})}function r(e,t,n){n.forEach(function(n){t.listeners(n).length>0&&i(n,e,t)}),t.on("newListener",function(r){n.indexOf(r)>-1&&t.listeners(r).length<1&&i(r,e,t)})}function o(e){this.events=e.slice(),this.__private__={target:null,source:null}}o.prototype.from=function(e){return this.__private__.source=e,this.__private__.target&&r(e,this.__private__.target,this.events),this},o.prototype.to=function(e){return this.__private__.target=e,this.__private__.source&&r(this.__private__.source,e,this.events),this},t.exports=o},{}],26:[function(e,t,n){"use strict";function i(e){var t=this;r.call(this,Math.floor(e.duration||0)),this.video=e,[a.PLAYING,a.PAUSE,a.TIMEUPDATE].forEach(function(n){return e.addEventListener(n,function(){return t.tick()},!1)})}var r=e("./VideoTracker"),o=e("util").inherits,a=e("./enums/HTML_MEDIA_EVENTS");o(i,r),i.prototype._getState=function(){return{playing:!this.video.paused,currentTime:this.video.currentTime}},t.exports=i},{"./VideoTracker":30,"./enums/HTML_MEDIA_EVENTS":31,util:23}],27:[function(e,t,n){"use strict";function i(e){return e}function r(e,t){(e||[]).forEach(function(e){e=e.replace(/^\s+|\s+$/,""),(new Image).src=t(e)})}function o(e,t){this.pixels=e.reduce(function(e,t){return(e[t.event]||(e[t.event]=[])).push(t.uri),e},{}),this.__private__={mapper:t||i}}var a=e("./enums/VPAID_EVENTS");o.prototype.manualCase=function(e){function t(e,t,s){function u(e){return o((t||i)(e))}s&&!s()||(a.PlayToBridge(e,n[e]),r(n[e],u))}var n=this.pixels,o=this.__private__.mapper,a=this;t(e)},o.prototype.PlayToBridge=function(e,t){},o.prototype.track=function(e){function t(e,t,a){function u(e){return s((t||i)(e))}return function(){a&&!a()||(o.PlayToBridge(e,n[e]),r(n[e],u))}}var n=this.pixels,o=this,s=this.__private__.mapper,u=e.adVolume;e.on(a.AdSkipped,t("skip")),e.on(a.AdStarted,t("creativeView")),e.on(a.AdVolumeChange,t("unmute",null,function(){return 0===u&&e.adVolume>0})),e.on(a.AdVolumeChange,t("mute",null,function(){return u>0&&0===e.adVolume})),e.on(a.AdImpression,t("impression")),e.on(a.AdVideoStart,t("start")),e.on(a.AdVideoFirstQuartile,t("firstQuartile")),e.on(a.AdVideoMidpoint,t("midpoint")),e.on(a.AdVideoThirdQuartile,t("thirdQuartile")),e.on(a.AdVideoComplete,t("complete")),e.on(a.AdClickThru,t("clickThrough")),e.on(a.AdUserAcceptInvitation,t("acceptInvitationLinear")),e.on(a.AdUserMinimize,t("collapse")),e.on(a.AdUserClose,t("closeLinear")),e.on(a.AdPaused,t("pause")),e.on(a.AdPlaying,t("resume")),e.on(a.AdError,t("error",function(e){return e.replace(/\[ERRORCODE\]/g,901)})),e.on(a.AdVolumeChange,function(){u=e.adVolume})},t.exports=o},{"./enums/VPAID_EVENTS":33}],28:[function(e,t,n){"use strict";function i(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}function r(){var e,t,n,i,o={},a=arguments.length;for(e=0;e<a;e++){t=arguments[e]||{};for(n in t)i=t[n],void 0===o[n]&&(o[n]=i),"object"==typeof i&&(o[n]=r(o[n],i))}return o}function o(e){return e}function a(){return new Error("VASTPlayer not ready.")}function s(e){return function(){var t=this,n=this.__private__.player;return this.ready?n[e].apply(n,arguments).then(function(){return t}):w.reject(a())}}function u(e){return{get:function(){if(!this.ready)throw a();return this.__private__.player[e]},set:function(t){if(!this.ready)throw a();return this.__private__.player[e]=t}}}function c(e,t){var n=this;l.call(this),this.__private__={index:-1,container:e,config:r(t,{vast:{resolveWrappers:!0,maxRedirects:5},tracking:{mapper:o}}),vast:null,ready:!1,player:null,pType:0},this.on(g.AdRemainingTimeChange,function(e){var t=n.adRemainingTime,i=n.adDuration;if(!i||!t)return!0;var t=i-t;return n.__private__.config.timerFunc({sec:t,dur:i,index:n.__private__.index}),!0}),this.on(g.AdSkipped,function(e){}),this.on(g.AdClickThru,function(e,t,r){if(this.__private__.index==-1)return i()&&("undefined"!=typeof this.isPaused&&this.isPaused?(this.isPaused=0,this.resumeAd()):(this.isPaused=1,this.pauseAd())),!1;if(n.vast){var o=e||n.vast.get("ads[0].creatives[0].videoClicks.clickThrough");r&&o&&window.open(o)}})}var l=e("events").EventEmitter,d=e("util").inherits,p=e("vastacular").VAST,f=e("./players/JavaScriptVPAID"),h=e("./players/FlashVPAID"),v=e("./players/HTMLVideo"),m=e("./players/IOSVideo"),y=e("./enums/MIME"),g=e("./enums/VPAID_EVENTS"),_=e("./EventProxy"),w=e("lie"),x=e("./PixelReporter");d(c,l),Object.defineProperties(c.prototype,{container:{get:function(){return this.__private__.container}},config:{get:function(){return this.__private__.config}},vast:{get:function(){return this.__private__.vast}},ready:{get:function(){return this.__private__.ready}},adRemainingTime:u("adRemainingTime"),adDuration:u("adDuration"),adVolume:u("adVolume")}),c.prototype.PlayMp4=function(e){var t=this;if(i())var n=new m(t.container);else var n=new v(t.container);var r=new _(g);return r.from(n).to(t),t.__private__.player=n,t.__private__.index=-1,n.load(e.mediafiles,{}).then(function(){return t.__private__.ready=!0,t.__private__.player.video.controls=!0,t.emit("ready"),t}).catch(function(e){throw t.emit("error",e),e})},c.prototype.preparePlay=function(e){var t=this,n=new _(g);return n.from(t.__private__.player).to(t),t.__private__.player.load(t._mediaFiles,t._parameters).then(function(){return t._reporter.track(t.__private__.player),t.__private__.ready=!0,t.emit("ready"),t}).catch(function(e){throw t.emit("error",e),e})},c.prototype.loadNew=function(e){function t(){var e=!1;if("undefined"!=typeof navigator.plugins&&"object"==typeof navigator.plugins["Shockwave Flash"])e=!0;else if("undefined"!=typeof window.ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(e){}return e}var n=this,r=this.config.vast;return p.fetch(e,r).then(function(e){var r=i(),o=function(){var i=e.filter("ads[0].creatives[0].mediaFiles",function(e){return(e.type===y.JAVASCRIPT||"application/x-javascript"===e.type)&&"VPAID"===e.apiFramework}),o=e.filter("ads[0].creatives[0].mediaFiles",function(e){return e.type===y.FLASH&&"VPAID"===e.apiFramework&&t()}),a=e.filter("ads[0].creatives[0].mediaFiles",function(){return!0});return i.length>0?(n.__private__.pType=1,{player:new f(n.container),mediaFiles:i}):!r&&o.length>0?(n.__private__.pType=2,{player:new h(n.container,c.vpaidSWFLocation),mediaFiles:o}):r?(n.__private__.pType=3,{player:new m(n.container),mediaFiles:a}):(n.__private__.pType=3,{player:new v(n.container),mediaFiles:a})}(),a=e.get("ads[0].creatives[0].parameters"),s=[].concat(e.map("ads[0].impressions",function(e){return{event:"impression",uri:e.uri.replace(/^\s+|\s+$/,"")}}),e.map("ads[0].errors",function(e){return{event:"error",uri:e.replace(/^\s+|\s+$/,"")}}),e.get("ads[0].creatives[0].trackingEvents"),e.map("ads[0].creatives[0].videoClicks.clickTrackings",function(e){return{event:"clickThrough",uri:e.replace(/^\s+|\s+$/,"")}}));if(!o||!o.player)throw"no config of player";var u=(o.player,new x(s,n.config.tracking.mapper));return n.__private__.vast=e,n.__private__.index=n.linkIndex,n.__private__.player=o.player,n._reporter=u,n._mediaFiles=o.mediaFiles,n._parameters=a,!0}).catch(function(e){throw n.emit("error",e),e})},c.prototype.startAd=s("startAd"),c.prototype.stopAd=s("stopAd"),c.prototype.pauseAd=s("pauseAd"),c.prototype.resumeAd=s("resumeAd"),c.vpaidSWFLocation="https://cdn.jsdelivr.net/vast-player/0.2.9/vast-player--vpaid.swf",t.exports=c},{"./EventProxy":25,"./PixelReporter":27,"./enums/MIME":32,"./enums/VPAID_EVENTS":33,"./players/FlashVPAID":35,"./players/HTMLVideo":36,"./players/IOSVideo":37,"./players/JavaScriptVPAID":38,events:7,lie:9,util:23,vastacular:42}],29:[function(e,t,n){"use strict";function i(e){var t=e.split(".").map(parseFloat);this.string=e,this.major=t[0],this.minor=t[1],this.patch=t[2],Object.freeze(this)}i.prototype.toString=function(){return this.string},t.exports=i},{}],30:[function(e,t,n){"use strict";function i(e,t){t.fired[e]||(t.emit(e),t.fired[e]=!0)}function r(e){o.apply(this,arguments),this.duration=e,this.seconds=Array.apply([],new Array(e)).map(function(){return!1}),this.fired=[s.AdVideoStart,s.AdVideoFirstQuartile,s.AdVideoMidpoint,s.AdVideoThirdQuartile,s.AdVideoComplete].reduce(function(e,t){return e[t]=!1,e},{})}var o=e("events").EventEmitter,a=e("util").inherits,s=e("./enums/VPAID_EVENTS");a(r,o),r.prototype.tick=function(){function e(e){var n=o[e-1];return t.slice(0,n).every(function(e){return e===!0})}var t=this.seconds,n=this._getState(),r=Math.round(n.currentTime)-1;r>-1&&this.emit(s.AdRemainingTimeChange,{sec:r,dur:this.duration});var o=[1,2,3,4].map(function(e){return Math.floor(this.duration/4*e)},this);n.playing&&(i(s.AdVideoStart,this),r>-1&&(this.seconds[r]=!0)),e(1)&&i(s.AdVideoFirstQuartile,this),e(2)&&i(s.AdVideoMidpoint,this),e(3)&&i(s.AdVideoThirdQuartile,this),e(4)&&i(s.AdVideoComplete,this)},t.exports=r},{"./enums/VPAID_EVENTS":33,events:7,util:23}],31:[function(e,t,n){"use strict";var i=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"];i.forEach(function(e){this[e.toUpperCase()]=e},i),Object.freeze(i),t.exports=i},{}],32:[function(e,t,n){var i={JAVASCRIPT:"application/javascript",FLASH:"application/x-shockwave-flash"};Object.freeze(i),t.exports=i},{}],33:[function(e,t,n){"use strict";var i=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"];i.forEach(function(e){i[e]=e}),Object.freeze(i),t.exports=i},{}],34:[function(e,t,n){"use strict";var i=e("./window"),r=document.createElement("video"),o=e("./enums/MIME");n.isDesktop=!/Android|Silk|Mobile|PlayBook/.test(i.navigator.userAgent),n.canPlay=function(e){var t=i.navigator.mimeTypes,n=i.ActiveXObject;switch(e){case o.FLASH:try{return new n("ShockwaveFlash.ShockwaveFlash")?2:0}catch(e){return t&&t[o.FLASH]?2:0}return 0;case o.JAVASCRIPT:case"application/x-javascript":return 2;default:if(r.canPlayType)switch(r.canPlayType(e)){case"probably":return 2;case"maybe":return 1;default:return 0}}return 0},Object.freeze(n)},{"./enums/MIME":32,"./window":41}],35:[function(e,t,n){"use strict";function i(e,t){r.apply(this,arguments),this.swfURI=t,this.object=null}var r=e("./VPAID"),o=e("util").inherits,a=e("lie"),s=e("../uuid"),u=e("querystring"),c=e("../enums/VPAID_EVENTS"),l=e("../VPAIDVersion");o(i,r),i.prototype.load=function(e,t){var n=this,i=e[0].uri,r=e[0].bitrate;return new a(function(e,o){function a(e){n.container.removeChild(d),n.api=null,n.object=null,delete window[p],e&&o(e)}var d=document.createElement("object"),p="vast_player__"+s(20),f=u.stringify({vpaidURI:i,eventCallback:p});d.type="application/x-shockwave-flash",d.data=n.swfURI+"?"+f,d.style.display="block",d.style.width="100%",d.style.height="100%",d.style.border="none",d.style.opacity="0",d.innerHTML=['<param name="movie" value="'+n.swfURI+'">','<param name="flashvars" value="'+f+'">','<param name="quality" value="high">','<param name="play" value="false">','<param name="loop" value="false">','<param name="wmode" value="opaque">','<param name="scale" value="noscale">','<param name="salign" value="lt">','<param name="allowScriptAccess" value="always">'].join("\n"),n.object=d,window[p]=function(e){switch(e.type){case c.AdClickThru:return n.emit(e.type,e.url,e.Id,e.playerHandles);case c.AdInteraction:case c.AdLog:return n.emit(e.type,e.Id);case c.AdError:return n.emit(e.type,e.message);default:return n.emit(e.type)}},n.once("VPAIDInterfaceReady",function(){var e=d.getBoundingClientRect(),i=n.vpaidVersion=new l(d.handshakeVersion("2.0"));return i.major>2?o(new Error("VPAID version "+i+" is not supported.")):(n.on("VPAIDInterfaceResize",function(){var e=d.getBoundingClientRect();n.resizeAd(e.width,e.height,"normal")}),void d.initAd(e.width,e.height,"normal",r,t,null))}),n.once(c.AdLoaded,function(){n.api=d,d.style.opacity="1",e(n)}),n.once(c.AdError,function(e){a(new Error(e))}),n.once(c.AdStopped,a),console.log([226,d]),n.container.appendChild(d)})},t.exports=i},{"../VPAIDVersion":29,"../enums/VPAID_EVENTS":33,"../uuid":40,"./VPAID":39,lie:9,querystring:14,util:23}],36:[function(e,t,n){"use strict";function i(e,t,n){return e.addEventListener(t,n,!1)}function r(e,t,n){return e.removeEventListener(t,n,!1)}function o(e,t,n){return i(e,t,function i(){return r(e,t,i),n.apply(this,arguments)})}function a(e,t){function n(){return new Error("The <video> has not been loaded.")}return function(){if(!this.video){if(t)return d.reject(n());throw n()}return e.apply(this,arguments)}}function s(e,t){var n=t.width,i=e.map(function(e){return{mediaFile:e,playability:p(e.type)}}).filter(function(e){return e.playability>0}).sort(f("-playability","-mediaFile.bitrate")),r=i.map(function(e){return Math.abs(n-e.mediaFile.width)}),o=i[r.indexOf(Math.min.apply(Math,r))];return!o||o.playability<1?null:o.mediaFile}function u(e){this.container=e,this.video=null,this.__private__={hasPlayed:!1}}var c=e("events").EventEmitter,l=e("util").inherits,d=e("lie"),p=e("../environment").canPlay,f=e("sort-by"),h=e("../enums/VPAID_EVENTS"),v=e("../enums/HTML_MEDIA_EVENTS"),m=e("../HTMLVideoTracker"),y=e("../EventProxy");l(u,c),Object.defineProperties(u.prototype,{adRemainingTime:{get:a(function(){return this.video.duration-this.video.currentTime})},adDuration:{get:a(function(){return this.video.duration})},adVolume:{get:a(function(){return this.video.volume}),set:a(function(e){this.video.volume=e})}}),u.prototype.load=function(e){var t=this;
return new d(function(n,r){var a=document.createElement("video"),u=s(e,t.container.getBoundingClientRect());return u?(a.setAttribute("webkit-playsinline",!0),a.src=u.uri,a.preload="auto",a.style.display="block",a.style.width="100%",a.style.height="100%",a.style.objectFit="contain",o(a,v.LOADEDMETADATA,function(){var e=new m(a),r=new y(h);r.from(e).to(t),t.video=a,n(t),t.emit(h.AdLoaded),i(a,v.DURATIONCHANGE,function(){t.emit(h.AdDurationChange)}),i(a,v.VOLUMECHANGE,function(){t.emit(h.AdVolumeChange)})}),o(a,v.ERROR,function(){var e=a.error;t.emit(h.AdError,e.message),r(e)}),o(a,v.PLAYING,function(){t.__private__.hasPlayed=!0,t.emit(h.AdImpression)}),o(a,v.ENDED,function(){t.stopAd()}),i(a,"click",function(){t.emit(h.AdClickThru,null,null,!0)}),void t.container.appendChild(a)):r(new Error("There are no playable <MediaFile>s."))})},u.prototype.startAd=a(function(){var e=this,t=this.video;return this.__private__.hasPlayed?d.reject(new Error("The ad has already been started.")):new d(function(n){return o(t,v.PLAYING,function(){n(e),e.emit(h.AdStarted)}),t.play()})},!0),u.prototype.stopAd=a(function(){return this.container.removeChild(this.video),this.emit(h.AdStopped),d.resolve(this)},!0),u.prototype.pauseAd=a(function(){var e=this,t=this.video;return this.video.paused?d.resolve(this):new d(function(n){return o(t,v.PAUSE,function(){n(e),e.emit(h.AdPaused)}),t.pause()})},!0),u.prototype.resumeAd=a(function(){var e=this,t=this.video;return this.__private__.hasPlayed?this.video.paused?new d(function(n){return o(t,v.PLAY,function(){n(e),e.emit(h.AdPlaying)}),t.play()}):d.resolve(this):d.reject(new Error("The ad has not been started yet."))},!0),t.exports=u},{"../EventProxy":25,"../HTMLVideoTracker":26,"../enums/HTML_MEDIA_EVENTS":31,"../enums/VPAID_EVENTS":33,"../environment":34,events:7,lie:9,"sort-by":16,util:23}],37:[function(e,t,n){"use strict";function i(e,t,n){return e.addEventListener(t,n,!1)}function r(e,t,n){return e.removeEventListener(t,n,!1)}function o(e,t,n){return i(e,t,function i(){return r(e,t,i),n.apply(this,arguments)})}function a(e,t){function n(){return new Error("The <video> has not been loaded.")}return function(){if(!this.video){if(t)return d.reject(n());throw n()}return e.apply(this,arguments)}}function s(e,t){var n=t.width,i=e.map(function(e){return{mediaFile:e,playability:p(e.type)}}).filter(function(e){return e.playability>0}).sort(f("-playability","-mediaFile.bitrate")),r=i.map(function(e){return Math.abs(n-e.mediaFile.width)}),o=i[r.indexOf(Math.min.apply(Math,r))];return!o||o.playability<1?null:o.mediaFile}function u(e){this.container=e,this.video=null,this.__private__={hasPlayed:!1}}var c=e("events").EventEmitter,l=e("util").inherits,d=e("lie"),p=e("../environment").canPlay,f=e("sort-by"),h=e("../enums/VPAID_EVENTS"),v=e("../enums/HTML_MEDIA_EVENTS"),m=e("../HTMLVideoTracker"),y=e("../EventProxy");l(u,c),Object.defineProperties(u.prototype,{adRemainingTime:{get:a(function(){return this.video.duration-this.video.currentTime})},adDuration:{get:a(function(){return this.video.duration})},adVolume:{get:a(function(){return this.video.volume}),set:a(function(e){this.video.volume=e})}}),u.prototype.load=function(e){var t=this;return new d(function(n,r){var a=document.createElement("video"),u=s(e,t.container.getBoundingClientRect());return u?(a.setAttribute("muted",!0),a.setAttribute("playsinline",!0),a.setAttribute("webkit-playsinline",!0),a.src=u.uri,a.preload="auto",a.style.display="block",a.style.width="100%",a.style.height="100%",a.style.objectFit="contain",o(a,v.LOADEDMETADATA,function(){var e=new m(a),r=new y(h);r.from(e).to(t),t.video=a,n(t),t.emit(h.AdLoaded),i(a,v.DURATIONCHANGE,function(){t.emit(h.AdDurationChange)}),i(a,v.VOLUMECHANGE,function(){t.emit(h.AdVolumeChange)})}),o(a,v.ERROR,function(){var e=a.error;t.emit(h.AdError,e.message),r(e)}),o(a,v.PLAYING,function(){t.__private__.hasPlayed=!0,t.emit(h.AdImpression)}),o(a,v.ENDED,function(){t.stopAd()}),i(a,"click",function(){t.emit(h.AdClickThru,null,null,!0)}),void t.container.appendChild(a)):r(new Error("There are no playable <MediaFile>s."))})},u.prototype.startAd=a(function(){var e=this,t=this.video;return this.__private__.hasPlayed?d.reject(new Error("The ad has already been started.")):new d(function(n){return o(t,v.PLAYING,function(){n(e),e.emit(h.AdStarted)}),window.enableInlineVideo(t,{everywhere:!0}),t.play()})},!0),u.prototype.stopAd=a(function(){return this.emit(h.AdStopped),d.resolve(this)},!0),u.prototype.pauseAd=a(function(){var e=this,t=this.video;return this.video.paused?d.resolve(this):(t.className="",new d(function(n){return o(t,v.PAUSE,function(){n(e),e.emit(h.AdPaused)}),t.pause()}))},!0),u.prototype.resumeAd=a(function(){var e=this,t=this.video;return this.__private__.hasPlayed?(t.className="IIV",this.video.paused?new d(function(n){return o(t,v.PLAY,function(){n(e),e.emit(h.AdPlaying)}),t.play()}):d.resolve(this)):d.reject(new Error("The ad has not been started yet."))},!0),t.exports=u},{"../EventProxy":25,"../HTMLVideoTracker":26,"../enums/HTML_MEDIA_EVENTS":31,"../enums/VPAID_EVENTS":33,"../environment":34,events:7,lie:9,"sort-by":16,util:23}],38:[function(e,t,n){"use strict";function i(){o.apply(this,arguments),this.frame=null,this.playDelay=1}var r=e("util").inherits,o=e("./VPAID"),a=e("lie"),s=e("../enums/VPAID_EVENTS"),u=(e("../environment").isDesktop,e("../VPAIDVersion"));r(i,o),i.prototype.load=function(e,t){var n=this,i=e[0].uri,r=e[0].bitrate;return new a(function(e,o){function a(e){try{n.container.removeChild(d)}catch(e){}n.frame=null,n.api=null,e&&o(e)}function c(e){if(n.playDelay)return console.log([123,e,n.playDelay,"log vpaid"]),e>0?void setTimeout(function(){c(e-1)},1e3):void a(new Error("vpaid не загрузился в течении 7 сек"))}function l(i,c){function l(){var e=d.getBoundingClientRect();n.resizeAd(e.width,e.height,"normal")}if(c=c||3,!(c<=0)){var p=d.contentWindow;if(!p||"function"!=typeof p.getVPAIDAd)throw"но плеер";var h=d.contentWindow.getVPAIDAd(),v=d.getBoundingClientRect(),m=d.contentWindow.document.body,y=n.vpaidVersion=new u(h.handshakeVersion("2.0"));if(y.major>2)return o(new Error("VPAID version "+y+" is not supported."));d.contentWindow.addEventListener("resize",l,!1),s.forEach(function(e){return h.subscribe(function(){for(var t=new Array(arguments.length),i=arguments.length;i--;)t[i]=arguments[i];return n.emit.apply(n,[e].concat(t))},e)}),n.once(s.AdLoaded,function(){n.playDelay=0,d.style.opacity="1",n.api=h,e(n)}),n.once(s.AdError,function(e){a(new Error(e))}),n.once(s.AdStopped,a),h.initAd(v.width,v.height,"normal",r,{AdParameters:t},{slot:m,videoSlot:f,videoSlotCanAutoPlay:!0})}}var d=document.createElement("iframe"),p=document.createElement("script"),f=document.createElement("video");d.scrolling="no",c(7),d.src="about:blank",d.style.width="100%",d.style.height="100%",d.style.display="block",d.style.opacity="0",d.style.border="none",f.setAttribute("webkit-playsinline","true"),f.style.display="block",f.style.width="100%",f.style.height="100%",f.style.objectFit="contain",n.container.appendChild(d),d.contentWindow.document.open(),d.contentWindow.document.close(),d.contentWindow.document.body.style.margin="0",n.frame=d,p.src=i,p.onload=l,p.onerror=function(){a(new Error("Failed to load MediaFile ["+i+"]."))};var h=document.createElement("style");h.innerHTML=".advark-video {top:0} \n",h.innerHTML+=".advark-controls\t.advark-controls div.advark-vpaid {    position: absolute;    pointer-events: none;    top: 0;    z-index: 32000;} \n",h.id="prev_div_134",d.contentWindow.document.body.appendChild(f),d.contentWindow.document.head.appendChild(p),d.contentWindow.document.head.appendChild(h)})},t.exports=i},{"../VPAIDVersion":29,"../enums/VPAID_EVENTS":33,"../environment":34,"./VPAID":39,lie:9,util:23}],39:[function(e,t,n){"use strict";function i(e,t){return function(){function n(){return new Error("Ad has not been loaded.")}function i(){return"undefined"!=typeof o[e],o[e].apply(o,r)}var r=arguments,o=this.api,a=this;if(!t){if(!o)throw n();return i()}return new s(function(e,r){return o?(a.once(t,function(){e(a)}),i()):r(n())})}}function r(e){this.container=e,this.api=null,this.vpaidVersion=null}var o=e("util").inherits,a=e("events").EventEmitter,s=e("lie"),u=e("../enums/VPAID_EVENTS");o(r,a),Object.defineProperties(r.prototype,{adLinear:{get:i("getAdLinear")},adWidth:{get:i("getAdWidth")},adHeight:{get:i("getAdHeight")},adExpanded:{get:i("getAdExpanded")},adSkippableState:{get:i("getAdSkippableState")},adRemainingTime:{get:i("getAdRemainingTime")},adDuration:{get:i("getAdDuration")},adVolume:{get:i("getAdVolume"),set:i("setAdVolume")},adCompanions:{get:i("getAdCompanions")},adIcons:{get:i("getAdIcons")}}),r.prototype.load=function(){throw new Error("VPAID subclass must implement load() method.")},r.prototype.resizeAd=i("resizeAd",u.AdSizeChange),r.prototype.startAd=i("startAd",u.AdStarted),r.prototype.stopAd=i("stopAd",u.AdStopped),r.prototype.pauseAd=i("pauseAd",u.AdPaused),r.prototype.resumeAd=i("resumeAd",u.AdPlaying),r.prototype.expandAd=i("expandAd",u.AdExpandedChange),r.prototype.collapseAd=i("collapseAd",u.AdExpandedChange),r.prototype.skipAd=i("skipAd",u.AdSkipped),t.exports=r},{"../enums/VPAID_EVENTS":33,events:7,lie:9,util:23}],40:[function(e,t,n){"use strict";var i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r=i.length;t.exports=function(e){for(var t="";e--;)t+=i.charAt(Math.floor(Math.random()*r));return t}},{}],41:[function(e,t,n){t.exports=window},{}],42:[function(e,t,n){n.VAST=e("./lib/VAST")},{"./lib/VAST":43}],43:[function(e,t,n){"use strict";function i(){}function r(e){f({description:null,survey:null},e)}function o(){}function a(e){f({trackingEvents:[],parameters:null,videoClicks:null},e),(e.mediaFiles||[]).forEach(function(e){f({id:null,bitrate:null,scalable:null,maintainAspectRatio:null,apiFramework:null},e)})}function s(e){e.companions.forEach(function(e){f({expandedWidth:null,expandedHeight:null,apiFramework:null,trackingEvents:[],clickThrough:null,altText:null,parameters:null},e)})}function u(e){f({trackingEvents:[]},e),e.ads.forEach(function(e){f({id:null,expandedWidth:null,expandedHeight:null,scalable:null,maintainAspectRatio:null,minSuggestedDuration:null,apiFramework:null,clickThrough:null,parameters:null},e)})}function c(e){p(e,this,!0),this.ads.forEach(function(e){f({system:{version:null},errors:[]},e),e.creatives.forEach(function(e){f({id:null,sequence:null,adID:null},e),_[e.type](e)}),g[e.type](e)}),this.__private__={wrappers:[],inlines:[]}}var l=e("lie"),d=e("superagent"),p=e("./utils/copy"),f=e("./utils/defaults"),h=e("./utils/extend"),v=e("./utils/nodeify_promise"),m=Array.prototype.push,y=e("./xml_from_vast"),g={inline:r,wrapper:o},_={linear:a,companions:s,nonLinear:u};Object.defineProperties(c.prototype,{wrappers:{get:function(){var e=this.__private__.wrappers;return e.length=0,m.apply(e,this.filter("ads",function(e){return"wrapper"===e.type})),e}},inlines:{get:function(){var e=this.__private__.inlines;return e.length=0,m.apply(e,this.filter("ads",function(e){return"inline"===e.type})),e}}}),c.prototype.get=function(e){var t=(e||"").match(/[^\[\]\.]+/g)||[];return t.reduce(function(e,t){return(e||void 0)&&e[t]},this)},c.prototype.set=function(e,t){function n(e,t){switch(e.input.charAt(t)){case".":return Object;case"[":return Array;case"]":return n(e,t+1);default:return null}}var i=function(){for(var t,i=/[^\[\]\.]+/g,r=[];t=i.exec(e);)r.push({token:t[0],type:n(t,t.index+t[0].length)});return r}(),r=i.pop(),o=i.reduce(function(e,t){return e[t.token]||(e[t.token]=new t.type)},this);if(!e)throw new Error("prop must be specified.");return o[r.token]=t},c.prototype.map=function(e,t){var n=this.get(e)||[],i=n.length,r=[];if(!(n instanceof Array))return r;for(var o=0;o<i;o++)r.push(t.call(this,n[o],o,n));return r},c.prototype.filter=function(e,t){var n=this.get(e)||[],i=n.length,r=[];if(!(n instanceof Array))return r;for(var o=0;o<i;o++)t.call(this,n[o],o,n)&&r.push(n[o]);return r},c.prototype.find=function(e,t){var n=this.get(e)||[],i=n.length;if(n instanceof Array)for(var r=0;r<i;r++)if(t.call(this,n[r],r,n))return n[r]},c.prototype.toPOJO=function(){var e=JSON.parse(JSON.stringify(this));return delete e.__private__,e},c.prototype.copy=function(){return new this.constructor(this.toPOJO())},c.prototype.resolveWrappers=function(){function e(e,t){function n(e){return function(t){return t.type===e}}function i(e){return{linear:e.filter(n("linear")),companions:e.filter(n("companions")),nonLinear:e.filter(n("nonLinear"))}}var r=i(e.creatives);return f(e.impressions,t.impressions),f(e.errors,t.errors),"undefined"!=typeof e.extensions&&f(e.extensions,t.extensions),t.creatives.forEach(function(e){f(r[e.type].shift()||{},e)}),m.apply(t.creatives,"wrapper"!==t.type?[]:["linear","companions","nonLinear"].reduce(function(e,t){return e.concat(r[t])},[])),t}var t=isNaN(arguments[0])?1/0:arguments[0],n="function"==typeof arguments[0]?arguments[0]:arguments[1],i=this.constructor,r=this;return 0===t?l.reject(new Error("Too many redirects were made.")):v(l.all(this.map("wrappers",function(e){return l.resolve(d.get(e.vastAdTagURI)).then(function(t){return{wrapper:e,response:i.pojoFromXML(t.text).ads}})})).then(function(t){var n=t.map(function(e){return e.wrapper}),o=t.map(function(e){return e.response});return new i(h(r.toPOJO(),{ads:r.map("ads",function(t){var i=n.indexOf(t),r=n[i],a=o[i];return a?a.map(e.bind(null,r)):[t]}).reduce(function(e,t){return e.concat(t)})}))}).then(function(e){if(e.get("wrappers.length")>0){e.resolveWrappers(t-1);return e.resolveWrappers(t-1)}return e}),n)},c.prototype.toXML=function(){var e=this.validate();if(!e.valid)throw new Error("VAST is invalid: "+e.reasons.join(", "));return y(this)},c.prototype.validate=function(){function e(e,t){e||a.push(t)}function t(t){e(o.get(t),t+" is required")}function n(t){e(o.get(t+".length")>0,t+" must contain at least one value")}function r(e,i){i.exists.map(e).forEach(t),i.atLeastOne.map(e).forEach(n)}var o=this,a=[],s={inline:function(e){var t={linear:function(e){r(e,{exists:["duration"],atLeastOne:["mediaFiles"]})},companions:function(e){o.get(e("companions")).forEach(function(t,n){function i(t){return e("companions["+n+"]."+t)}r(i,{exists:[],atLeastOne:["resources"]})})},nonLinear:function(e){o.get(e("ads")).forEach(function(t,n){function i(t){return e("ads["+n+"]."+t)}r(i,{exists:[],atLeastOne:["resources"]})})}};r(e,{exists:["title"],atLeastOne:["creatives"]}),o.get(e("creatives")).forEach(function(n,o){function a(t){return e("creatives["+o+"]."+t)}r(a,{exists:["type"],atLeastOne:[]}),(t[n.type]||i)(a)})},wrapper:function(e){r(e,{exists:["vastAdTagURI"],atLeastOne:[]})}};return r(function(e){return e},{exists:[],atLeastOne:["ads"]}),this.get("ads").forEach(function(e,t){function n(e){return"ads["+t+"]."+e}r(n,{exists:["type","system.name"],atLeastOne:["impressions"]}),(s[e.type]||i)(n)}),{valid:0===a.length,reasons:0===a.length?null:a}},c.pojoFromXML=e("./pojo_from_xml"),c.fetch=function(e){var t="object"==typeof arguments[1]?arguments[1]||{}:{},n="function"==typeof arguments[2]?arguments[2]:arguments[1],i=this;return v(l.resolve(d.get(e).set(t.headers||{})).then(function(e){var n=new i(i.pojoFromXML(e.text));return t.resolveWrappers?n.resolveWrappers(t.maxRedirects):n}),n)},t.exports=c},{"./pojo_from_xml":44,"./utils/copy":46,"./utils/defaults":47,"./utils/extend":48,"./utils/nodeify_promise":49,"./xml_from_vast":56,lie:9,superagent:17}],44:[function(e,t,n){"use strict";function i(e){}function r(e){return e?e[0]||{attributes:{}}:{attributes:{}}}function o(e){var t=e.find("StaticResource,IFrameResource,HTMLResource");return t.map(function(e){return{type:e.tag.replace(/Resource$/,"").toLowerCase(),creativeType:e.attributes.creativeType,data:e.value}})}function a(e){var t=r(e.find("Duration")),n=e.find("Tracking"),o=r(e.find("AdParameters")),a=e.find("VideoClicks")[0],s=e.find("MediaFile");return window.MPOverControl.reportCurrentLoader(s),{type:"linear",duration:p(t.value)||void 0,trackingEvents:n.map(function(e){return e.value=e.value.replace(/^\s+|\s+$/,""),i({eventName:e.attributes.event,val:e.value}),{event:e.attributes.event,uri:e.value}}),parameters:o.value,videoClicks:a&&function(){var e=r(a.find("ClickThrough")),t=a.find("ClickTracking"),n=a.find("CustomClick");return{clickThrough:e.value,clickTrackings:t.map(function(e){return e.value=e.value.replace(/^\s+|\s+$/,""),i({eventName:"clickTrackings",val:e.value}),e.value}),customClicks:n.map(function(e){return e.value=e.value.replace(/^\s+|\s+$/,""),i({eventName:"customClick",val:e.value}),{id:e.attributes.id,uri:e.value}})}}(),mediaFiles:s.map(function(e){var t=e.attributes;return{id:t.id,delivery:t.delivery,type:t.type,uri:e.value,bitrate:m(t.bitrate),width:m(t.width),height:m(t.height),scalable:f(t.scalable),maintainAspectRatio:f(t.maintainAspectRatio),apiFramework:t.apiFramework}})}}function s(e){var t=e.find("Companion");return{type:"companions",companions:t.map(function(e){var t=e.find("Tracking"),n=r(e.find("CompanionClickThrough")),a=r(e.find("AltText")),s=r(e.find("AdParameters"));return{id:e.attributes.id,width:m(e.attributes.width),height:m(e.attributes.height),expandedWidth:m(e.attributes.expandedWidth),expandedHeight:m(e.attributes.expandedHeight),apiFramework:e.attributes.apiFramework,resources:o(e),trackingEvents:t.map(function(e){return i({eventName:e.attributes.event,val:e.value}),e.value=e.value.replace(/^\s+|\s+$/,""),{event:e.attributes.event,uri:e.value}}),clickThrough:n.value,altText:a.value,parameters:s.value}})}}function u(e){var t=e.find("NonLinear"),n=e.find("Tracking");return{type:"nonLinear",ads:t.map(function(e){var t=r(e.find("NonLinearClickThrough")),n=r(e.find("AdParameters"));return{id:e.attributes.id,width:m(e.attributes.width),height:m(e.attributes.height),expandedWidth:m(e.attributes.expandedWidth),expandedHeight:m(e.attributes.expandedHeight),scalable:f(e.attributes.scalable),maintainAspectRatio:f(e.attributes.maintainAspectRatio),minSuggestedDuration:p(e.attributes.minSuggestedDuration)||void 0,apiFramework:e.attributes.apiFramework,resources:o(e),clickThrough:t.value,parameters:n.value}}),trackingEvents:n.map(function(e){return e.value=e.value.replace(/^\s+|\s+$/,""),i({eventName:e.attributes.event,val:e.value}),{event:e.attributes.event,uri:e.value}})}}function c(e){var t=r(e.find("AdTitle")),n=r(e.find("Description")),i=r(e.find("Survey"));return{type:"inline",title:t.value,description:n.value,survey:i.value}}function l(e){var t=r(e.find("VASTAdTagURI"));return{type:"wrapper",vastAdTagURI:t.value}}var d=e("./utils/parse_xml"),p=e("./utils/timestamp_to_seconds"),f=e("./utils/string_to_boolean"),h=e("./utils/extend"),v=e("./utils/trim_object"),m=e("./utils/numberify"),y={linear:a,companions:s,nonLinear:u},g={inline:c,wrapper:l};t.exports=function(e){var t=d(e);if(!t("VAST")[0])throw new Error("["+e+"] is not a valid VAST document.");return v({version:r(t("VAST")).attributes.version,ads:t("Ad").map(function(e){var t=r(e.find("Wrapper,InLine")).tag.toLowerCase(),n=r(e.find("AdSystem")),i=e.find("Error"),o=e.find("Impression"),a=e.find("Extension"),s=a.map(function(e){if(e&&e.attributes)return e.value?e.value=e.value.replace(/^\s+|\s+$/,""):e.value="",{type:e.attributes.type,value:e.value}}),u=e.find("Creative");return h({id:e.attributes.id,system:{name:n.value,version:n.attributes.version},errors:i.map(function(e){return e.value}),impressions:o.map(function(e){return e.value=e.value.replace(/^\s+|\s+$/,""),{uri:e.value,id:e.attributes.id}}),extensions:s,creatives:u.map(function(e){var t=function(){var t=r(e.find("Linear,CompanionAds,NonLinearAds"));switch(t.tag){case"Linear":return"linear";case"CompanionAds":return"companions";case"NonLinearAds":return"nonLinear"}}();return h({id:e.attributes.id,sequence:m(e.attributes.sequence),adID:e.attributes.AdID},y[t](e))})},g[t](e))})},!0)}},{"./utils/extend":48,"./utils/numberify":50,"./utils/parse_xml":51,"./utils/string_to_boolean":53,"./utils/timestamp_to_seconds":54,"./utils/trim_object":55}],45:[function(e,t,n){"use strict";function i(e){return null!==e&&void 0!==e}function r(e){return void 0!==e?String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function o(e){for(var t="";e--;)t+=" ";return t}function a(e){var t=void 0!==e?function(e){for(var t,n,i=[],r=/]]>/g,o=0;t=r.exec(e);)n=t.index+2,i.push(t.input.substring(o,n)),o=n;return i.push(e.substring(o,e.length)),i}(String(e)):[""];return t.reduce(function(e,t){return e+"<![CDATA["+t+"]]>"},"")}function s(e){return e.cdata?a(e.value):r(e.value)}function u(e,t,n){var a=e.tag,c=e.attributes||{},l=Object.keys(c),d=e.children||[],p=e.value,f=d.length>0,h=l.every(function(e){return i(c[e])})&&l.length>0,v=i(p)||f||h,m=o(t),y="<"+a+Object.keys(c).reduce(function(e,t){return n&&!i(c[t])?e:e+" "+t+'="'+r(c[t])+'"'},"")+">",g="</"+a+">";return!n||v||e.required?f?[m+y].concat(e.children.reduce(function(e,i){return e.concat(u(i,t+4,n))},[]),[m+g]):[m+y+s(e)+g]:[]}t.exports=function(e,t){return['<?xml version="1.0" encoding="UTF-8"?>'].concat(u(e,0,t)).join("\n")}},{}],46:[function(e,t,n){"use strict";function i(e,t,n){return Object.keys(e).reduce(function(t,i){return t[i]=n?o(e[i],null,!0):e[i],t},t||{})}function r(e,t,n){var i=t||[];return a.apply(i,n?e.map(function(e){return o(e,null,!0)}):e),i}function o(e){var t=("object"==typeof arguments[1]||null)&&arguments[1],n="boolean"==typeof arguments[1]?arguments[1]:arguments[2];return Object(e)!==e?e:e instanceof Array?r(e,t,n):i(e,t,n)}var a=Array.prototype.push;t.exports=o},{}],47:[function(e,t,n){"use strict";function i(e){return Object(e)===e}function r(e){return e instanceof Array}var o=Array.prototype.push;t.exports=function e(t,n){return[t,n].every(r)?(o.apply(n,t.filter(function(e){return n.indexOf(e)<0})),n):Object.keys(t).reduce(function(n,r){var o=[t[r],n[r]];return o.every(i)&&e(t[r],n[r]),r in n||(n[r]=t[r]),n},n)}},{}],48:[function(e,t,n){"use strict";t.exports=function(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){return Object.keys(t||{}).reduce(function(e,n){return e[n]=t[n],e},e)},{})}},{}],49:[function(e,t,n){"use strict";t.exports=function(e,t){return"function"!=typeof t?e:(e.then(function(e){t(null,e)},function(e){t(e)}),e)}},{}],50:[function(e,t,n){"use strict";t.exports=function(e){if(/string|number|boolean/.test(typeof e))return isNaN(e)?void 0:Number(e)}},{}],51:[function(e,t,n){"use strict";function i(e){var t=e.childElementCount>0;return{tag:e.tagName,value:t?null:e.textContent,attributes:s.call(e.attributes,function(e,t){return e[t.name]=t.value,e},{}),find:function(t){return r(e.querySelectorAll(t))},children:function(){return a.call(e.childNodes,function(e){return e instanceof Element}).map(i)}}}function r(e){return o.call(e,i)}var o=Array.prototype.map,a=Array.prototype.filter,s=Array.prototype.reduce,u=new DOMParser;t.exports=function(e){var t=u.parseFromString(e,"application/xml");return function(e){return r(t.querySelectorAll(e))}}},{}],52:[function(e,t,n){"use strict";function i(e){return(e>9?"":"0")+e.toString()}t.exports=function(e){return Number(e)!==e?null:[Math.floor(e/60/60),Math.floor(e/60%60),Math.floor(e%60%60)].map(i).join(":")}},{}],53:[function(e,t,n){"use strict";t.exports=function(e){switch((e||"").toLowerCase()){case"true":return!0;case"false":return!1}}},{}],54:[function(e,t,n){"use strict";t.exports=function(e){var t=(e||"").match(/^(\d\d):(\d\d):(\d\d)$/);return t&&t.slice(1,4).map(parseFloat).reduce(function(e,t,n){var i=Math.pow(60,Math.abs(n-2));return e+t*i},0)}},{}],55:[function(e,t,n){"use strict";t.exports=function e(t,n){return Object(t)!==t?t:Object.keys(t).reduce(function(i,r){return n&&t[r]instanceof Array?i[r]=t[r].filter(function(e){return void 0!==e}).map(function(t){return e(t,!0)}):n&&t[r]instanceof Object?i[r]=e(t[r],!0):void 0!==t[r]&&(i[r]=t[r]),i},{})}},{}],56:[function(e,t,n){"use strict";function i(e){return{tag:"TrackingEvents",children:e.map(function(e){return{tag:"Tracking",attributes:{event:e.event},value:e.uri,cdata:!0}})}}function r(e){return e.map(function(e){return{tag:function(e){switch(e){case"static":return"StaticResource";case"iframe":return"IFrameResource";case"html":return"HTMLResource"}}(e.type),attributes:{creativeType:e.creativeType},value:e.data,cdata:!0}})}function o(e){return{tag:"AdParameters",value:e.parameters}}function a(e){return{tag:"Linear",children:[{tag:"Duration",value:c(e.duration)},i(e.trackingEvents),o(e)].concat(e.videoClicks?[{tag:"VideoClicks",children:[{tag:"ClickThrough",value:e.videoClicks.clickThrough,cdata:!0}].concat(e.videoClicks.clickTrackings.map(function(e){return{tag:"ClickTracking",value:e,cdata:!0}}),e.videoClicks.customClicks.map(function(e){return{tag:"CustomClick",attributes:{id:e.id},value:e.uri,cdata:!0}}))}]:[],[{tag:"MediaFiles",children:e.mediaFiles.map(function(e){return{tag:"MediaFile",attributes:{id:e.id,width:e.width,height:e.height,bitrate:e.bitrate,type:e.type,delivery:e.delivery,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,apiFramework:e.apiFramework},value:e.uri,cdata:!0}})}])}}function s(e){return{tag:"CompanionAds",children:e.companions.map(function(e){return{tag:"Companion",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,apiFramework:e.apiFramework},children:r(e.resources).concat([i(e.trackingEvents),{tag:"CompanionClickThrough",value:e.clickThrough,cdata:!0},{tag:"AltText",value:e.altText},o(e)])}})}}function u(e){return{tag:"NonLinearAds",children:e.ads.map(function(e){return{tag:"NonLinear",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,minSuggestedDuration:c(e.minSuggestedDuration),apiFramework:e.apiFramework},children:r(e.resources).concat([{tag:"NonLinearClickThrough",value:e.clickThrough,cdata:!0},o(e)])}}).concat([i(e.trackingEvents)])}}var c=e("./utils/seconds_to_timestamp"),l=e("./utils/compile_xml"),d={linear:a,companions:s,nonLinear:u};t.exports=function(e){return l({tag:"VAST",attributes:{version:e.get("version")},children:e.map("ads",function(e){return{tag:"Ad",attributes:{id:e.id},children:[{tag:function(){switch(e.type){case"inline":return"InLine";case"wrapper":return"Wrapper"}}(),children:[{tag:"AdSystem",attributes:{version:e.system.version},value:e.system.name},{tag:"AdTitle",value:e.title},{tag:"Description",value:e.description},{tag:"Survey",value:e.survey,cdata:!0},{tag:"VASTAdTagURI",value:e.vastAdTagURI,cdata:!0}].concat(e.errors.map(function(e){return{tag:"Error",value:e,cdata:!0}}),e.impressions.map(function(e){return{tag:"Impression",value:e.uri,cdata:!0,attributes:{id:e.id}}}),[{tag:"Creatives",children:e.creatives.map(function(e){return{tag:"Creative",attributes:{id:e.id,sequence:e.sequence,AdID:e.adID},children:[function(t){return d[t](e)}(e.type)]}}),required:!0}])}]}})},!0)}},{"./utils/compile_xml":45,"./utils/seconds_to_timestamp":52}],57:[function(e,t,n){"use strict";var i=e("./../models/multidispatcher"),r=e("./../models/configurator");window.multiDispatcher=i,window.Configurator=r},{"./../models/configurator":2,"./../models/multidispatcher":5}]},{},[57]);